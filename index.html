<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <title>Muziekspeler Ultra</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #fff;
      text-align: center;
      padding: 30px;
    }
    button {
      background: #1db954;
      color: white;
      border: none;
      padding: 10px 16px;
      margin: 4px;
      font-size: 14px;
      border-radius: 8px;
      cursor: pointer;
    }
    button:hover { background: #1ed760; }
    input[type="file"], input[type="number"], input[type="text"] {
      margin: 10px;
      padding: 6px;
      border-radius: 6px;
      border: none;
    }
    #playlist, #searchResults {
      margin-top: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
    }
    .track {
      background: #222;
      padding: 10px;
      width: 70%;
      border-radius: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .track.playing { background: #1db954; }
    .controls { display: flex; gap: 4px; }
    iframe { margin-top: 15px; display: none; }
    .settings {
      background: #222;
      border-radius: 8px;
      padding: 15px;
      width: 70%;
      margin: 20px auto;
      text-align: left;
    }
  </style>
</head>
<body>
  <h1>ğŸµ Muziekspeler Ultra</h1>

  <div>
    <input type="file" id="fileInput" accept="audio/*" multiple>
    <label>ğŸ¶ Upload muziek</label>
  </div>

  <div>
    <input type="file" id="adInput" accept="audio/*" multiple>
    <label>ğŸ“¢ Upload reclame-deuntjes</label>
  </div>

  <div>
    <button id="prevButton">â®ï¸ Vorige</button>
    <button id="playButton">â–¶ï¸ Afspelen</button>
    <button id="nextButton">â­ï¸ Volgende</button>
    <button id="stopButton">â¹ï¸ Stop</button>
  </div>

  <div class="settings">
    <h3>âš™ï¸ Reclame-instellingen</h3>
    <label>Na hoeveel nummers komt reclame?</label>
    <input type="number" id="adsEvery" min="1" value="3"><br>
    <label>Hoeveel reclames achter elkaar?</label>
    <input type="number" id="adsCount" min="1" value="1"><br>
    <button id="saveSettings">ğŸ’¾ Instellingen opslaan</button>
  </div>

  <h3>ğŸ” Zoek YouTube:</h3>
  <input type="text" id="searchInput" placeholder="Zoek nummer...">
  <button id="searchButton">Zoek</button>

  <div id="searchResults"></div>

  <h3>ğŸ“œ Playlist</h3>
  <div id="playlist"></div>

  <iframe id="youtubePlayer" width="0" height="0"></iframe>

  <script>
    const fileInput = document.getElementById('fileInput');
    const adInput = document.getElementById('adInput');
    const searchInput = document.getElementById('searchInput');
    const searchButton = document.getElementById('searchButton');
    const searchResults = document.getElementById('searchResults');
    const playButton = document.getElementById('playButton');
    const stopButton = document.getElementById('stopButton');
    const nextButton = document.getElementById('nextButton');
    const prevButton = document.getElementById('prevButton');
    const playlistDiv = document.getElementById('playlist');
    const youtubeFrame = document.getElementById('youtubePlayer');
    const adsEveryInput = document.getElementById('adsEvery');
    const adsCountInput = document.getElementById('adsCount');
    const saveSettingsBtn = document.getElementById('saveSettings');

    let playlist = JSON.parse(localStorage.getItem('playlist')) || [];
    let ads = JSON.parse(localStorage.getItem('ads')) || [];
    let settings = JSON.parse(localStorage.getItem('settings')) || { adsEvery: 3, adsCount: 1 };

    adsEveryInput.value = settings.adsEvery;
    adsCountInput.value = settings.adsCount;

    let currentIndex = 0;
    let isPlaying = false;
    let trackCount = 0;
    let audio = new Audio();

    function saveData() {
      localStorage.setItem('playlist', JSON.stringify(playlist));
      localStorage.setItem('ads', JSON.stringify(ads));
      localStorage.setItem('settings', JSON.stringify(settings));
    }

    function renderPlaylist() {
      playlistDiv.innerHTML = '';
      playlist.forEach((track, i) => {
        const div = document.createElement('div');
        div.className = 'track' + (i === currentIndex && isPlaying ? ' playing' : '');
        const name = document.createElement('div');
        name.textContent = `${i + 1}. ${track.name}`;
        const controls = document.createElement('div');
        controls.className = 'controls';

        const up = document.createElement('button');
        up.textContent = 'â¬†ï¸';
        up.onclick = () => {
          if (i > 0) [playlist[i], playlist[i - 1]] = [playlist[i - 1], playlist[i]];
          saveData(); renderPlaylist();
        };

        const down = document.createElement('button');
        down.textContent = 'â¬‡ï¸';
        down.onclick = () => {
          if (i < playlist.length - 1) [playlist[i], playlist[i + 1]] = [playlist[i + 1], playlist[i]];
          saveData(); renderPlaylist();
        };

        const del = document.createElement('button');
        del.textContent = 'ğŸ—‘ï¸';
        del.onclick = () => {
          playlist.splice(i, 1);
          saveData(); renderPlaylist();
        };

        controls.appendChild(up);
        controls.appendChild(down);
        controls.appendChild(del);
        div.appendChild(name);
        div.appendChild(controls);
        playlistDiv.appendChild(div);
      });
    }

    // --- Upload lokale bestanden ---
    fileInput.addEventListener('change', e => {
      for (let file of e.target.files) {
        const url = URL.createObjectURL(file);
        playlist.push({ type: 'local', name: file.name, url });
      }
      saveData(); renderPlaylist();
    });

    // --- Upload reclames ---
    adInput.addEventListener('change', e => {
      for (let file of e.target.files) {
        const url = URL.createObjectURL(file);
        ads.push({ name: file.name, url });
      }
      saveData();
      alert("ğŸ“¢ Reclames toegevoegd!");
    });

    // --- YouTube zoeken ---
    const YT_API_KEY = "YOUR_API_KEY_HERE";
    searchButton.onclick = async () => {
      const query = searchInput.value.trim();
      if (!query) return;
      const res = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&maxResults=5&q=${encodeURIComponent(query)}&key=${YT_API_KEY}`);
      const data = await res.json();
      searchResults.innerHTML = '';
      data.items.forEach(video => {
        const div = document.createElement('div');
        div.innerHTML = `
          <img src="${video.snippet.thumbnails.default.url}" />
          <strong>${video.snippet.title}</strong>
          <button>â• Voeg toe</button>
        `;
        div.querySelector('button').onclick = () => {
          playlist.push({
            type: 'youtube',
            name: video.snippet.title,
            videoId: video.id.videoId
          });
          saveData(); renderPlaylist();
        };
        searchResults.appendChild(div);
      });
    };

    // --- Afspeelfuncties ---
    function playTrack(index) {
      if (playlist.length === 0) return;
      const track = playlist[index];
      isPlaying = true;
      currentIndex = index;
      youtubeFrame.style.display = 'none';
      audio.pause();

      if (track.type === 'local') {
        audio.src = track.url;
        audio.play();
      } else if (track.type === 'youtube') {
        youtubeFrame.src = `https://www.youtube.com/embed/${track.videoId}?autoplay=1`;
        youtubeFrame.style.display = 'block';
      }
      renderPlaylist();
    }

    function playAdsThenNext() {
      let count = 0;
      const playNextAd = () => {
        if (count >= settings.adsCount || ads.length === 0) {
          currentIndex = (currentIndex + 1) % playlist.length;
          playTrack(currentIndex);
          return;
        }
        const ad = ads[Math.floor(Math.random() * ads.length)];
        audio.src = ad.url;
        youtubeFrame.style.display = 'none';
        audio.play();
        count++;
        audio.onended = playNextAd;
      };
      playNextAd();
    }

    function nextTrack() {
      trackCount++;
      if (ads.length > 0 && trackCount % settings.adsEvery === 0) {
        playAdsThenNext();
        return;
      }
      currentIndex = (currentIndex + 1) % playlist.length;
      playTrack(currentIndex);
    }

    function prevTrack() {
      currentIndex = (currentIndex - 1 + playlist.length) % playlist.length;
      playTrack(currentIndex);
    }

    playButton.onclick = () => { if (!isPlaying) playTrack(currentIndex); };
    stopButton.onclick = () => { audio.pause(); isPlaying = false; youtubeFrame.src = ''; renderPlaylist(); };
    nextButton.onclick = nextTrack;
    prevButton.onclick = prevTrack;

    audio.addEventListener('ended', () => {
      if (isPlaying) nextTrack();
    });

    // --- Opslaan instellingen ---
    saveSettingsBtn.onclick = () => {
      settings.adsEvery = parseInt(adsEveryInput.value);
      settings.adsCount = parseInt(adsCountInput.value);
      saveData();
      alert("Instellingen opgeslagen!");
    };

    // --- Init ---
    renderPlaylist();
  </script>
</body>
</html>

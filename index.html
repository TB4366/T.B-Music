<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>THT Bewaking ‚Äî Offline app</title>
  <style>
    :root{--bg:#f6f7fb;--card:#ffffff;--muted:#6b7280;--accent:#0f62fe}
    *{box-sizing:border-box}
    body{font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; margin:0; background:var(--bg); color:#111}
    .container{max-width:980px;margin:28px auto;padding:20px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
    h1{font-size:20px;margin:0}
    .card{background:var(--card);border-radius:12px;padding:16px;box-shadow:0 6px 18px rgba(20,20,40,0.06);}

    form{display:grid;grid-template-columns:1fr 200px 120px 120px;gap:10px;align-items:end}
    label{font-size:12px;color:var(--muted);display:block;margin-bottom:6px}
    input[type=text], input[type=date], select{width:100%;padding:10px;border-radius:8px;border:1px solid #e6e9ef}
    button{padding:10px 12px;border-radius:8px;border:0;background:var(--accent);color:white;cursor:pointer}
    .btn-ghost{background:transparent;border:1px solid #e6e9ef;color:var(--muted)}

    .controls{display:flex;gap:8px;align-items:center}
    .list{margin-top:18px}
    .item{display:flex;gap:12px;align-items:center;padding:12px;border-radius:10px;border:1px solid #f0f2f6;background:linear-gradient(180deg, rgba(255,255,255,0.6), rgba(250,250,252,0.6));}
    .meta{flex:1;min-width:0}
    .title{font-weight:600;margin:0}
    .small{font-size:13px;color:var(--muted)}

    .status{min-width:100px;text-align:center;padding:6px 8px;border-radius:10px;font-weight:600}
    .expired{background:#ffefef;color:#9b1c1c}
    .soon{background:#fffbeb;color:#7a4a00}
    .ok{background:#eefdf3;color:#0b7a3a}

    .right{display:flex;gap:8px;align-items:center}
    .icon-btn{background:transparent;border:0;padding:6px;border-radius:8px;cursor:pointer}

    .filters{display:flex;gap:8px;margin-bottom:12px}
    .search{flex:1}

    /* modal */
    .modal-backdrop{position:fixed;inset:0;background:rgba(6,8,20,0.45);display:none;align-items:center;justify-content:center}
    .modal{background:var(--card);padding:18px;border-radius:12px;max-width:680px;width:95%;max-height:80vh;overflow:auto}

    footer{margin-top:18px;text-align:center;color:var(--muted);font-size:13px}

    @media(max-width:760px){form{grid-template-columns:1fr;}
      .right{flex-wrap:wrap}
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>THT Bewaking ‚Äî offline HTML app</h1>
      <div style="font-size:13px;color:var(--muted)">Opslag: <strong>localStorage</strong></div>
    </header>

    <section class="card">
      <form id="addForm">
        <div>
          <label for="name">Productnaam</label>
          <input id="name" type="text" placeholder="Bijv. melk, jam, kipfilet" required>
        </div>
        <div>
          <label for="date">THT-datum</label>
          <input id="date" type="date" required>
        </div>
        <div>
          <label for="qty">Aantal (optioneel)</label>
          <input id="qty" type="text" placeholder="bv. 1 of 2" />
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <button type="submit">Voeg toe</button>
          <button id="clearAll" type="button" class="btn-ghost">Wis alles</button>
        </div>
      </form>

      <div style="margin-top:14px;display:flex;gap:12px;align-items:center;flex-wrap:wrap">
        <div class="filters" style="flex:1">
          <input id="search" class="search" type="text" placeholder="Zoek op naam...">
        </div>
        <div class="controls">
          <button id="showAll" class="btn-ghost" type="button">Toon alles</button>
          <button id="showExp" class="btn-ghost" type="button">THT bewaking</button>
          <button id="exportCsv" class="btn-ghost" type="button">Exporteer CSV</button>
        </div>
      </div>

      <div class="list" id="list"></div>
    </section>

    <footer class="card" style="margin-top:14px">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div style="font-weight:600">Legenda</div>
          <div style="font-size:13px;color:var(--muted)">Rood = over datum ¬∑ Geel = binnen 3 dagen ¬∑ Groen = ok</div>
        </div>
        <div style="font-size:13px;color:var(--muted)">Tip: deze app werkt offline in je browser. Verwijder browserdata verwijdert ook de producten.</div>
      </div>
    </footer>
  </div>

  <!-- modal -->
  <div id="modal" class="modal-backdrop" role="dialog" aria-hidden="true">
    <div class="modal">
      <h2 id="modalTitle">THT Bewaking</h2>
      <p id="modalInfo" class="small">Lijst met producten die over datum of bijna verlopen zijn.</p>
      <div id="modalList" style="display:grid;gap:10px;margin-top:10px"></div>
      <div style="display:flex;justify-content:flex-end;margin-top:12px">
        <button id="modalClose" class="btn-ghost">Sluit</button>
      </div>
    </div>
  </div>

  <script>
    // Simple THT app using localStorage
    const LS_KEY = 'thtProducts_v1';

    // DOM
    const addForm = document.getElementById('addForm');
    const nameIn = document.getElementById('name');
    const dateIn = document.getElementById('date');
    const qtyIn = document.getElementById('qty');
    const listEl = document.getElementById('list');
    const search = document.getElementById('search');
    const showExp = document.getElementById('showExp');
    const showAll = document.getElementById('showAll');
    const exportCsv = document.getElementById('exportCsv');
    const clearAll = document.getElementById('clearAll');

    const modal = document.getElementById('modal');
    const modalList = document.getElementById('modalList');
    const modalClose = document.getElementById('modalClose');

    // utilities
    const today = () => { const d = new Date(); d.setHours(0,0,0,0); return d; };
    const parseDate = (s) => { if(!s) return null; const d = new Date(s + 'T00:00:00'); d.setHours(0,0,0,0); return d; };
    const daysBetween = (a,b) => Math.round((a - b) / (1000*60*60*24)); // a - b

    // storage
    function load(){
      try{ const raw = localStorage.getItem(LS_KEY); return raw ? JSON.parse(raw) : []; }catch(e){return []}
    }
    function save(arr){ localStorage.setItem(LS_KEY, JSON.stringify(arr)); }

    // seed small demo if empty
    if(load().length === 0){
      const sample = [
        {id:cryptoRandomId(), name:'Volle melk', date: (()=>{const d=new Date(); d.setDate(d.getDate()+1); return d.toISOString().slice(0,10);})(), qty:'1'},
        {id:cryptoRandomId(), name:'Rode paprika', date: (()=>{const d=new Date(); d.setDate(d.getDate()-2); return d.toISOString().slice(0,10);})(), qty:'2'},
        {id:cryptoRandomId(), name:'Jam', date: (()=>{const d=new Date(); d.setDate(d.getDate()+10); return d.toISOString().slice(0,10);})(), qty:''}
      ]; save(sample);
    }

    function cryptoRandomId(){return Math.random().toString(36).slice(2,9)}

    // render
    function getStatusClass(dStr){
      const d = parseDate(dStr);
      if(!d) return 'ok';
      const td = today();
      const diff = daysBetween(d, td); // d - today
      if(diff < 0) return 'expired';
      if(diff <= 3) return 'soon';
      return 'ok';
    }

    function render(filterText=''){
      const arr = load().slice().sort((a,b)=> new Date(a.date) - new Date(b.date));
      listEl.innerHTML = '';
      const q = filterText.trim().toLowerCase();
      const frag = document.createDocumentFragment();
      arr.forEach(item=>{
        if(q && !item.name.toLowerCase().includes(q)) return;
        const status = getStatusClass(item.date);
        const el = document.createElement('div'); el.className='item';
        el.innerHTML = `
          <div style="width:8px;height:48px;border-radius:8px;background:linear-gradient(180deg,rgba(0,0,0,0.06),transparent)"></div>
          <div class="meta">
            <div class="title">${escapeHtml(item.name)}</div>
            <div class="small">THT: ${item.date || '‚Äî'} ${item.qty ? '¬∑ Aantal: '+escapeHtml(item.qty):''}</div>
          </div>
          <div class="status ${status}">${status === 'expired' ? 'Over datum' : status === 'soon' ? 'Binnen 3 dagen' : 'Ok'}</div>
          <div class="right">
            <button class="icon-btn" data-action="edit" data-id="${item.id}" title="Bewerk">‚úèÔ∏è</button>
            <button class="icon-btn" data-action="remove" data-id="${item.id}" title="Verwijder">üóëÔ∏è</button>
            <button class="icon-btn" data-action="used" data-id="${item.id}" title="Markeer gebruikt">‚úÖ</button>
          </div>
        `;
        frag.appendChild(el);
      });
      listEl.appendChild(frag);
    }

    function escapeHtml(s){ return String(s).replace(/[&<>\"]/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;', '"':'&quot;' }[c])); }

    // form submit
    addForm.addEventListener('submit', e=>{
      e.preventDefault();
      const name = nameIn.value.trim();
      const date = dateIn.value;
      const qty = qtyIn.value.trim();
      if(!name || !date){ alert('Vul minimaal naam en THT-datum in.'); return; }
      const arr = load();
      arr.push({id:cryptoRandomId(), name, date, qty});
      save(arr);
      addForm.reset();
      render(search.value);
    });

    // list actions
    listEl.addEventListener('click', e=>{
      const btn = e.target.closest('button'); if(!btn) return;
      const action = btn.dataset.action; const id = btn.dataset.id;
      if(action === 'remove'){
        if(!confirm('Weet je zeker dat je dit product wilt verwijderen?')) return;
        const arr = load().filter(x=>x.id!==id); save(arr); render(search.value);
      } else if(action === 'edit'){
        const arr = load(); const it = arr.find(x=>x.id===id); if(!it) return;
        nameIn.value = it.name; dateIn.value = it.date; qtyIn.value = it.qty || '';
        // remove old entry (we will re-add on submit)
        save(arr.filter(x=>x.id!==id)); render(search.value);
      } else if(action === 'used'){
        const arr = load(); const it = arr.find(x=>x.id===id); if(!it) return;
        if(!confirm('Markeer als gebruikt (verwijdert item)?')) return;
        save(arr.filter(x=>x.id!==id)); render(search.value);
      }
    });

    // search
    search.addEventListener('input', ()=> render(search.value));

    // show modal with expired/soon
    showExp.addEventListener('click', ()=>{
      const arr = load();
      const td = today();
      const expired = arr.filter(it=>{
        const d = parseDate(it.date); if(!d) return false; return daysBetween(d, td) < 0;
      });
      const soon = arr.filter(it=>{
        const d = parseDate(it.date); if(!d) return false; const diff = daysBetween(d, td); return diff >=0 && diff <=3;
      });
      modalList.innerHTML = '';
      if(expired.length === 0 && soon.length === 0){ modalList.innerHTML = '<div class="small">Geen producten over datum of binnen 3 dagen.</div>'; }
      else{
        if(expired.length){
          const h = document.createElement('div'); h.innerHTML = '<strong>Over datum</strong>'; modalList.appendChild(h);
          expired.forEach(it=>{ const d=document.createElement('div'); d.className='item'; d.innerHTML=`<div class="meta"><div class="title">${escapeHtml(it.name)}</div><div class="small">THT: ${it.date}${it.qty? ' ¬∑ Aantal: '+escapeHtml(it.qty):''}</div></div><div class="status expired">Over datum</div>`; modalList.appendChild(d); });
        }
        if(soon.length){
          const h2 = document.createElement('div'); h2.innerHTML = '<strong>Binnen 3 dagen</strong>'; modalList.appendChild(h2);
          soon.forEach(it=>{ const d=document.createElement('div'); d.className='item'; d.innerHTML=`<div class="meta"><div class="title">${escapeHtml(it.name)}</div><div class="small">THT: ${it.date}${it.qty? ' ¬∑ Aantal: '+escapeHtml(it.qty):''}</div></div><div class="status soon">Binnen 3 dagen</div>`; modalList.appendChild(d); });
        }
      }
      openModal();
    });

    function openModal(){ modal.style.display='flex'; modal.setAttribute('aria-hidden','false'); }
    function closeModal(){ modal.style.display='none'; modal.setAttribute('aria-hidden','true'); }
    modalClose.addEventListener('click', closeModal);
    modal.addEventListener('click', e=>{ if(e.target === modal) closeModal(); });

    showAll.addEventListener('click', ()=>{ search.value=''; render(); });

    exportCsv.addEventListener('click', ()=>{
      const arr = load(); if(arr.length===0){ alert('Geen producten om te exporteren'); return; }
      const rows = [['naam','tht_datum','aantal']].concat(arr.map(r=>[r.name,r.date||'',r.qty||'']));
      const csv = rows.map(r=>r.map(c=>'"'+String(c).replace(/"/g,'""')+'"').join(',')).join('\n');
      const blob = new Blob([csv],{type:'text/csv'}); const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href=url; a.download='tht_export.csv'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    });

    clearAll.addEventListener('click', ()=>{
      if(!confirm('Weet je zeker dat je alle producten wilt verwijderen?')) return; localStorage.removeItem(LS_KEY); render();
    });

    // initial render
    render();
  </script>
</body>
</html>

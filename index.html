<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Legend Express Agar.io Extension</title>
    <script>
        // Versie
        const modVersion = '1.8';
        const version = 2;

        // Functie om externe scripts in te laden
        function loadScript(url) {
            return fetch(url)
                .then(response => response.text())
                .then(scriptText => {
                    const scriptEl = document.createElement('script');
                    scriptEl.textContent = scriptText;
                    document.body.appendChild(scriptEl);
                });
        }

        // Functie om HTML-pagina's in te laden en init script toe te voegen
        function loadHTML(url) {
            fetch(url)
                .then(response => response.text())
                .then(htmlText => {
                    const injected = htmlText.replace("</body>", `<script>init('${modVersion}');</script></body>`);
                    document.open();
                    document.write(injected);
                    document.close();
                    setTimeout(() => history.pushState(null, null, "/"), 2000);
                });
        }

        // Check locatie
        if (location.host === "agar.io" && location.pathname === "/") {
            const url = window.location.href;
            localStorage.setItem("url", url);
            location.href = "https://agar.io/legendmod" + location.hash;
        }

        // Mod website selectie op basis van pathname
        const mode = location.pathname.slice(1);
        let modWebsite;

        switch(mode) {
            case 'normal':
                modWebsite = 'https://agar.io';
                loadHTML(modWebsite);
                break;
            case 'hslo':
                modWebsite = 'https://hslo.io/install.user.js';
                loadScript(modWebsite);
                break;
            case 'agartool':
                modWebsite = 'https://www.agartool.io/agartool.user.js';
                loadScript(modWebsite);
                break;
            case 'vanilla':
                modWebsite = 'http://imasters.org.ru/agar/js/vanilla.user.js';
                loadScript(modWebsite);
                break;
            case 'ogario':
                modWebsite = 'https://cdn.ogario.ovh/v4/beta/ogario.v4.user.js';
                loadScript(modWebsite);
                break;
            case 'delta':
                modWebsite = 'https://deltav4.glitch.me/v4/index.html';
                loadHTML(modWebsite);
                break;
            case 'neo': 
                modWebsite = 'https://www.legendmod.ml/play.html?' + version;
                loadHTML(modWebsite);
                setTimeout(() => {
                    loadScript('https://jimboy3100.github.io/ExampleScripts/Neoprivate.js');
                }, 5000);
                break;
            case 'mobile': 
                modWebsite = 'https://www.legendmod.ml/play.html';
                loadHTML(modWebsite);
                setTimeout(() => {
                    loadScript('https://www.legendmod.ml/ExampleScripts/gamepad.user.js');
                }, 5000);
                break;
            case 'captcha':
                modWebsite = 'https://www.legendmod.ml/ogario/captcha.html';
                loadHTML(modWebsite);
                break;
            case 'legendmod': 
            default:
                modWebsite = 'https://www.legendmod.ml/play.html?' + version;
                loadHTML(modWebsite);
                break;
        }

        // Functie om URL parameters te lezen
        function getParameterByName(name, url) {
            if (!url) url = window.location.href;
            name = name.replace(/[\[\]]/g, "\\$&");
            const regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
                  results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, " "));
        }
    </script>
</head>
<body>
</body>
</html>

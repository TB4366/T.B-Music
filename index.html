<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tamigo Systeem</title>
<style>
body { font-family: Arial,sans-serif; margin:0; padding:0; background:#f4f4f4; }
h1 { text-align:center; margin:10px 0; }
#controls { text-align:center; margin-bottom:10px; }
#controls button { margin:0 5px; padding:6px 10px; }
.week-container { display:flex; overflow-x:auto; padding:10px; }
.day-column { min-width:200px; background:white; border-radius:10px; padding:10px; margin:0 10px; box-shadow:0 3px 10px rgba(0,0,0,0.2); flex-shrink:0; }
.day-column h3 { text-align:center; margin-bottom:10px; }
.shift { display:flex; align-items:center; padding:5px; margin:5px 0; border-radius:5px; cursor:pointer; user-select:none; flex-direction: column; }
.role-circle { width:25px; height:25px; border-radius:50%; display:flex; justify-content:center; align-items:center; color:white; font-weight:bold; margin-right:5px; font-size:0.8em;}
.shift-header { display:flex; width:100%; align-items:center; }
.shift-time { width:70px; text-align:center; margin-right:5px; font-size:0.9em;}
.shift-name { flex-shrink:1; font-weight:bold; display:flex; align-items:center; }
.gray-dot { width:10px; height:10px; border-radius:50%; background:#888; display:inline-block; margin-right:5px; }
#overlay { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.5); z-index:500; }
#shiftPopup, #personnelPopup, #rolePopup { display:none; position:fixed; background:#fff; padding:20px; border-radius:10px; width:400px; top:50%; left:50%; transform:translate(-50%,-50%); z-index:1000; box-shadow:0 5px 15px rgba(0,0,0,0.3);}
input, select { width:100%; margin-bottom:10px; padding:5px; }
button { cursor:pointer; margin-top:5px; }
.shift-day-actions { text-align:center; margin-top:5px; }
.shift-day-actions button { margin:2px; }
</style>
</head>
<body>

<h1>Tamigo Systeem</h1>
<div id="controls">
    <button onclick="prevWeek()">&#8592; Vorige Week</button>
    <span id="weekLabel">Week 1</span>
    <button onclick="nextWeek()">Volgende Week &#8594;</button>
    <br><br>
    <button onclick="openPersonnel()">Personeel</button>
    <button onclick="openRoles()">Rollen Beheren</button>
</div>

<div class="week-container" id="weekContainer"></div>
<div id="overlay"></div>

<!-- Shift Popup -->
<div id="shiftPopup">
<h3>Shift Toevoegen/Bewerken</h3>
<label>Medewerker:</label>
<select id="shiftEmployee"></select>
<label>Begin tijd:</label>
<input type="time" id="shiftStart" value="09:00">
<label>Eind tijd:</label>
<input type="time" id="shiftEnd" value="17:00">
<label>Pauze code (1=15,2=30,3=45,4=60 min):</label>
<input type="number" id="shiftPause" min="1" max="4" value="1">
<label>Status:</label>
<select id="shiftStatus">
  <option value="beschikbaar">Beschikbaar</option>
  <option value="verlof">Verlof</option>
  <option value="niet beschikbaar">Niet beschikbaar</option>
  <option value="stage">Stage</option>
  <option value="school">School</option>
  <option value="EHBO">EHBO</option>
  <option value="BHV">BHV</option>
</select>
<button onclick="saveShiftDetail()">Opslaan</button>
<button onclick="cancelShiftDetail()">Annuleren</button>
</div>

<!-- Personnel Popup -->
<div id="personnelPopup">
<h3>Personeel</h3>
<div id="employeeList"></div>
<button onclick="addEmployeePrompt()">Nieuwe Medewerker</button>
<button onclick="closePersonnel()">Sluiten</button>
</div>

<!-- Roles Popup -->
<div id="rolePopup">
<h3>Rollen Beheren</h3>
<div id="roleList"></div>
<button onclick="addRolePrompt()">Nieuwe Rol</button>
<button onclick="closeRoles()">Sluiten</button>
</div>

<script>
// --- Data ---
const days=["Maandag","Dinsdag","Woensdag","Donderdag","Vrijdag","Zaterdag","Zondag"];
let currentWeek=1;
let employees=[];
let roles=[];
let scheduleData={};
let editingShift=null;
let editingDay=null;

// --- Load / Save ---
function loadData(){
    employees=JSON.parse(localStorage.getItem("employees")||'[{"name":"Koe","age":25,"hourly":15,"role":"Leidinggevende","available":true}]');
    roles=JSON.parse(localStorage.getItem("roles")||'[{"name":"Leidinggevende","color":"red"},{"name":"Medewerker","color":"blue"}]');
    scheduleData=JSON.parse(localStorage.getItem("scheduleData")||'{}');
    if(!scheduleData[getWeekKey()]){ scheduleData[getWeekKey()]={}; days.forEach(d=>scheduleData[getWeekKey()][d]=[]);}
}
function saveData(){ 
    localStorage.setItem("employees",JSON.stringify(employees));
    localStorage.setItem("roles",JSON.stringify(roles));
    localStorage.setItem("scheduleData",JSON.stringify(scheduleData));
}
function getWeekKey(){ return "week"+currentWeek; }

// --- Week Render ---
function renderWeek(){
    document.getElementById("weekLabel").innerText="Week "+currentWeek;
    const container=document.getElementById("weekContainer");
    container.innerHTML="";
    if(!scheduleData[getWeekKey()]) scheduleData[getWeekKey()]={};

    days.forEach(day=>{
        if(!scheduleData[getWeekKey()][day]) scheduleData[getWeekKey()][day]=[];
        const col=document.createElement("div"); col.className="day-column"; col.dataset.day=day;
        col.innerHTML=`<h3>${day}</h3>`;
        const dayShifts=scheduleData[getWeekKey()][day];
        dayShifts.forEach(shift=>{
            const empObj=employees.find(e=>e.name===shift.employee);
            if(!empObj) return;
            const roleObj=roles.find(r=>r.name===empObj.role) || {color:"gray"};
            const div=document.createElement("div"); div.className="shift";
            const header=document.createElement("div"); header.className="shift-header";
            const circle=document.createElement("div"); circle.className="role-circle"; 
            circle.style.backgroundColor=roleObj.color;
            circle.innerText=empObj.name.charAt(0).toUpperCase();
            const time=document.createElement("div"); time.className="shift-time"; time.innerText=`${shift.start}-${shift.end} (${shift.pause*15}min)`;
            const nameDiv=document.createElement("div"); nameDiv.className="shift-name"; 
            const dot=document.createElement("span"); dot.className="gray-dot"; 
            dot.style.background = (shift.status !== "beschikbaar") ? "#888" : roleObj.color;
            nameDiv.appendChild(dot); nameDiv.appendChild(document.createTextNode(empObj.name));
            header.appendChild(circle); header.appendChild(time); header.appendChild(nameDiv);
            div.appendChild(header);
            div.addEventListener("click",()=>{ editingShift=shift; editingDay=day; openShiftPopup(); });
            col.appendChild(div);
        });

        // Voeg Shift Knop
        const addBtn=document.createElement("div"); addBtn.className="shift-day-actions";
        const btn=document.createElement("button"); btn.textContent="Voeg toe";
        btn.addEventListener("click",()=>{
            if(employees.length === 0){ alert("Voeg eerst personeel toe voordat je een shift kunt plannen."); return; }
            editingShift=null; editingDay=day; openShiftPopup();
        });
        addBtn.appendChild(btn); col.appendChild(addBtn);

        container.appendChild(col);
    });
    saveData();
}

// --- Shift Popup ---
function openShiftPopup(){
    document.getElementById("overlay").style.display="block";
    document.getElementById("shiftPopup").style.display="block";

    const empSelect=document.getElementById("shiftEmployee");
    empSelect.innerHTML="";
    employees.forEach(emp=>{
        const option=document.createElement("option");
        option.value=emp.name;
        option.text=emp.name;
        empSelect.appendChild(option);
    });

    if(editingShift){
        document.getElementById("shiftStart").value=editingShift.start;
        document.getElementById("shiftEnd").value=editingShift.end;
        document.getElementById("shiftPause").value=editingShift.pause;
        document.getElementById("shiftStatus").value=editingShift.status;
        empSelect.value = editingShift.employee;
    } else {
        document.getElementById("shiftStart").value="09:00";
        document.getElementById("shiftEnd").value="17:00";
        document.getElementById("shiftPause").value=1;
        document.getElementById("shiftStatus").value="beschikbaar";
    }
}

function saveShiftDetail(){
    const start = document.getElementById("shiftStart").value;
    const end = document.getElementById("shiftEnd").value;
    const pause = parseInt(document.getElementById("shiftPause").value);
    const status = document.getElementById("shiftStatus").value;
    const empName = document.getElementById("shiftEmployee").value;

    const empObj = employees.find(e => e.name === empName);
    if(!empObj){ alert("De geselecteerde medewerker bestaat niet! Voeg eerst een medewerker toe."); return; }

    if(!scheduleData[getWeekKey()]) scheduleData[getWeekKey()] = {};
    if(!scheduleData[getWeekKey()][editingDay]) scheduleData[getWeekKey()][editingDay] = [];

    if(editingShift){
        editingShift.start = start;
        editingShift.end = end;
        editingShift.pause = pause;
        editingShift.status = status;
        editingShift.employee = empName;
    } else {
        scheduleData[getWeekKey()][editingDay].push({employee: empName, start, end, pause, status});
    }

    editingShift = null; editingDay = null;
    closeShiftPopup();
    renderWeek();
}

// --- Shift Popup Controls ---
function cancelShiftDetail(){ editingShift=null; editingDay=null; closeShiftPopup(); }
function closeShiftPopup(){ document.getElementById("overlay").style.display="none"; document.getElementById("shiftPopup").style.display="none"; }

// --- Personnel ---
function openPersonnel(){ document.getElementById("overlay").style.display="block"; document.getElementById("personnelPopup").style.display="block"; renderPersonnel(); }
function renderPersonnel(){
    const list=document.getElementById("employeeList"); list.innerHTML="";
    employees.forEach(emp=>{
        let totalHours=0;
        for(const d of days){ const dayShifts=scheduleData[getWeekKey()][d]||[]; dayShifts.forEach(s=>{ if(s.employee===emp.name){ let [h1,m1]=s.start.split(":"); let [h2,m2]=s.end.split(":"); totalHours+=parseInt(h2)+parseInt(m2)/60-(parseInt(h1)+parseInt(m1)/60)-(s.pause*0.25); } });}
        const div=document.createElement("div");
        div.innerHTML=`<strong>${emp.name}</strong> - Rol: ${emp.role} - Leeftijd: ${emp.age} - Betaald: €${emp.hourly}/u - Uren gepland: ${totalHours.toFixed(1)}h 
        <button onclick="editEmployee('${emp.name}')">Bewerk</button> 
        <button onclick="removeEmployee('${emp.name}')">Verwijderen</button>`;
        list.appendChild(div);
    });
}
function addEmployeePrompt(){
    const name=prompt("Naam:"); if(!name) return;
    const age=parseInt(prompt("Leeftijd:"))||0;
    const hourly=parseFloat(prompt("Betaald per uur:"))||0;
    const role=prompt("Rol:"); 
    employees.push({name,age,hourly,role,available:true});
    saveData(); renderPersonnel(); renderWeek();
}
function editEmployee(name){ alert("Shift bewerken via weekrooster"); }
function removeEmployee(name){ 
    if(confirm(`Weet je zeker dat je ${name} wilt verwijderen?`)){
        employees=employees.filter(e=>e.name!==name);
        for(const d of days){ scheduleData[getWeekKey()][d]=scheduleData[getWeekKey()][d].filter(s=>s.employee!==name); }
        saveData(); renderPersonnel(); renderWeek();
    }
}
function closePersonnel(){ document.getElementById("overlay").style.display="none"; document.getElementById("personnelPopup").style.display="none"; }

// --- Roles ---
function openRoles(){ document.getElementById("overlay").style.display="block"; document.getElementById("rolePopup").style.display="block"; renderRoles(); }
function renderRoles(){ const list=document.getElementById("roleList"); list.innerHTML=""; roles.forEach(r=>{ const div=document.createElement("div"); div.innerHTML=`<span style="background:${r.color};color:white;padding:2px 5px;border-radius:3px;">${r.name}</span> 
<button onclick="deleteRole('${r.name}')">Verwijderen</button>`; list.appendChild(div);}); }
function addRolePrompt(){ const name=prompt("Naam rol:"); const color=prompt("Kleur rol:"); if(name && color){ roles.push({name,color}); saveData(); renderRoles(); renderWeek(); } }
function deleteRole(name){ if(confirm("Weet je zeker?")){ roles=roles.filter(r=>r.name!==name); employees.forEach(e=>{ if(e.role===name) e.role="";}); saveData(); renderRoles(); renderWeek(); } }
function closeRoles(){ document.getElementById("overlay").style.display="none"; document.getElementById("rolePopup").style.display="none"; }

// --- Week Navigation ---
function nextWeek(){ currentWeek++; if(!scheduleData[getWeekKey()]){ scheduleData[getWeekKey()]={}; days.forEach(d=>scheduleData[getWeekKey()][d]=[]);} renderWeek(); }
function prevWeek(){ if(currentWeek>1){ currentWeek--; renderWeek(); }}

// --- Init ---
loadData(); renderWeek();
</script>

</body>
</html>

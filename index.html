import React, { useEffect, useState } from "react";

function App() {
  const [token, setToken] = useState(""); // Spotify Access Token
  const [playlist, setPlaylist] = useState([]);
  const [player, setPlayer] = useState(null);

  useEffect(() => {
    // TODO: haal token via OAuth flow
  }, []);

  const initSpotifyPlayer = () => {
    if (!window.Spotify || !token) return;

    const player = new window.Spotify.Player({
      name: "Sportify 2.0 Player",
      getOAuthToken: cb => { cb(token); },
    });

    player.addListener('ready', ({ device_id }) => {
      console.log('Ready with Device ID', device_id);
    });

    setPlayer(player);
    player.connect();
  };

  const playTrack = (uri) => {
    fetch(`https://api.spotify.com/v1/me/player/play`, {
      method: "PUT",
      body: JSON.stringify({ uris: [uri] }),
      headers: {
        "Content-Type": "application/json",
        "Authorization": `Bearer ${token}`
      }
    });
  };

  return (
    <div>
      <h1>Sportify 2.0</h1>
      <button onClick={initSpotifyPlayer}>Verbind met Spotify</button>
      <div>
        {playlist.map(track => (
          <button onClick={() => playTrack(track.uri)}>Afspelen</button>
        ))}
      </div>
    </div>
  );
}

export default App;

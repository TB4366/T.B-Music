<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<title>Audio Remix van Video (MP4)</title>
<style>
body { font-family: sans-serif; padding: 20px; background: #f0f0f0; }
button, input { margin: 5px; padding: 10px; font-size: 16px; }
h1 { margin-bottom: 20px; }
.container { background: #fff; padding: 20px; border-radius: 10px; max-width: 600px; margin: auto; box-shadow: 0 4px 10px rgba(0,0,0,0.1);}
</style>
</head>
<body>

<div class="container">
<h1>MP4 Audio Remix App</h1>

<input type="file" id="videoFile" accept="video/mp4"><br><br>

<button id="playBtn">‚ñ∂ Play</button>
<button id="pauseBtn">‚è∏ Pause/Resume</button>
<button id="stopBtn">‚èπ Stop</button>
<button id="loopBtn">üîÅ Toggle Loop</button><br><br>

<button id="echoBtn">Echo</button>
<button id="lowPassBtn">Low-pass Filter</button>
<button id="highPassBtn">High-pass Filter</button>
<button id="speedUpBtn">Speed +</button>
<button id="slowDownBtn">Speed -</button><br><br>

<label>Volume: </label><input type="range" id="volumeSlider" min="0" max="2" step="0.01" value="1"><br><br>
</div>

<script>
let audioContext = new (window.AudioContext || window.webkitAudioContext)();
let videoElement = null;
let trackSource = null;
let gainNode = audioContext.createGain();
let echoNode = audioContext.createDelay(0.25);
let lowPassFilter = audioContext.createBiquadFilter(); lowPassFilter.type="lowpass";
let highPassFilter = audioContext.createBiquadFilter(); highPassFilter.type="highpass";

let echoActive=false, lowPassActive=false, highPassActive=false;
let isLooping=false;
let playbackRate=1;

document.getElementById('videoFile').addEventListener('change', function(e){
    const file = e.target.files[0];
    if(!file) return;

    // Maak een verborgen video element
    if(videoElement) { videoElement.pause(); videoElement.remove(); }
    videoElement = document.createElement('video');
    videoElement.src = URL.createObjectURL(file);
    videoElement.crossOrigin = "anonymous";
    videoElement.loop = false;

    trackSource = audioContext.createMediaElementSource(videoElement);
    connectNodes();

    alert("Video geladen! Audio kan nu afgespeeld worden.");
});

function connectNodes(){
    if(!trackSource) return;
    trackSource.disconnect();

    let currentNode = trackSource;
    if(echoActive){ currentNode.connect(echoNode); currentNode = echoNode; }
    if(lowPassActive){ currentNode.connect(lowPassFilter); currentNode = lowPassFilter; }
    if(highPassActive){ currentNode.connect(highPassFilter); currentNode = highPassFilter; }

    currentNode.connect(gainNode);
    gainNode.connect(audioContext.destination);
}

// Buttons
document.getElementById('playBtn').onclick = () => {
    if(!videoElement) { alert("Geen video geladen!"); return; }
    videoElement.playbackRate = playbackRate;
    videoElement.loop = isLooping;
    videoElement.play();
};
document.getElementById('pauseBtn').onclick = () => {
    if(!videoElement) return;
    if(videoElement.paused) videoElement.play();
    else videoElement.pause();
};
document.getElementById('stopBtn').onclick = () => {
    if(!videoElement) return;
    videoElement.pause();
    videoElement.currentTime = 0;
};
document.getElementById('loopBtn').onclick = () => {
    isLooping = !isLooping;
    if(videoElement) videoElement.loop = isLooping;
    alert("Loop: " + (isLooping ? "Aan" : "Uit"));
};

// Effect toggles
document.getElementById('echoBtn').onclick = () => { echoActive = !echoActive; connectNodes(); alert("Echo: " + (echoActive ? "Aan" : "Uit")); };
document.getElementById('lowPassBtn').onclick = () => { lowPassActive = !lowPassActive; connectNodes(); alert("Low-pass: " + (lowPassActive ? "Aan" : "Uit")); };
document.getElementById('highPassBtn').onclick = () => { highPassActive = !highPassActive; connectNodes(); alert("High-pass: " + (highPassActive ? "Aan" : "Uit")); };

// Speed control
document.getElementById('speedUpBtn').onclick = () => { playbackRate += 0.1; if(videoElement) videoElement.playbackRate = playbackRate; alert("Speed: " + playbackRate.toFixed(1)); };
document.getElementById('slowDownBtn').onclick = () => { playbackRate = Math.max(0.1, playbackRate - 0.1); if(videoElement) videoElement.playbackRate = playbackRate; alert("Speed: " + playbackRate.toFixed(1)); };

// Volume
document.getElementById('volumeSlider').addEventListener('input', function(){
    gainNode.gain.value = this.value;
});
</script>
</body>
</html>

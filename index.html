<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Skin Shop</title>
<style>
body { font-family: Arial, Helvetica, sans-serif; background:#0b0b0b; color:#eee; padding:20px; text-align:center; }
h1 { color:#0af; margin-bottom:6px; }

.top-bar { display:flex; justify-content:space-between; align-items:center; gap:10px; margin-bottom:16px; }
input, button, select { padding:8px 12px; border-radius:999px; border:0; font-size:14px; }
button { cursor:pointer; background:#0af; color:#000; }

.skins { display:flex; flex-wrap:wrap; gap:20px; justify-content:center; margin-top:10px; }
.skinContainer { width:160px; display:flex; flex-direction:column; align-items:center; }
.skin {
  width:150px; height:150px;
  border-radius:50%;
  overflow:hidden;
  position:relative;
  background:#222;
  display:flex; align-items:center; justify-content:center;
  transition:transform .12s, filter .12s;
  border:3px solid transparent;
}
.skin img { width:100%; height:100%; object-fit:cover; pointer-events:none; user-select:none; display:block; }
.skin:hover { transform:translateY(-4px); }
.grayed img { filter:grayscale(100%); opacity:.45; }
.skin.owned { border: 3px solid; border-image-slice: 1; border-width: 3px; border-image-source: linear-gradient(135deg,#00d1b2,#3bd1ff); }

.lock { position:absolute; top:6px; left:6px; background:rgba(0,0,0,.6); padding:6px; border-radius:50%; font-size:16px; }

.skinName { margin-top:8px; font-size:14px; }
.skinPrice { color:#ddd; font-size:13px; margin-top:4px; }

#purchasedSkins { display:flex; flex-wrap:wrap; gap:14px; justify-content:center; margin-top:10px; }
#purchasedSkins img { width:96px; height:96px; border-radius:50%; border:2px solid #0af; object-fit:cover; }

#currency { display:flex; gap:18px; align-items:center; justify-content:flex-end; font-size:16px; }
.currencyItem { display:flex; gap:6px; align-items:center; background:rgba(255,255,255,0.03); padding:6px 10px; border-radius:999px; }

#eventBarContainer { position:fixed; bottom:12px; left:50%; transform:translateX(-50%); display:flex; gap:8px; z-index:999; max-width:90%; overflow:auto; padding:6px; }
.eventCard { width:220px; height:2.2cm; border:2px solid #0af; border-radius:6px; overflow:hidden; position:relative; cursor:pointer; background:#111; }
.eventCard img { width:100%; height:100%; object-fit:cover; display:block; }
.eventCountdown { position:absolute; bottom:0; left:0; width:100%; background:rgba(0,0,0,0.6); color:#fff; font-size:12px; text-align:center; padding:4px 2px; }

#dealModal { display:none; position:fixed; left:50%; top:50%; transform:translate(-50%,-50%); background:#151515; color:#fff; border:2px solid #0af; padding:18px; border-radius:10px; z-index:2000; width:320px; max-width:90%; }
#dealModal img { width:100%; height:160px; object-fit:cover; border-radius:8px; }
#dealCountdown { font-weight:600; margin-top:8px; }
#dealNav { display:flex; justify-content:space-between; margin-top:10px; gap:8px; }
#dealModal button { margin-top:10px; }
</style>
</head>
<body>

<h1>Skin Shop</h1>

<div class="top-bar">
  <div id="infoText">Enter your key to load account or browse available skins</div>
  <div id="currency">
    <div class="currencyItem">ðŸ’° <span id="money">0.00</span></div>
    <div class="currencyItem">ðŸª™ <span id="coins">0</span></div>
  </div>
</div>

<div style="margin:8px 0 12px;">
  <input id="keyInput" placeholder="Enter your key here">
  <button onclick="loadKey()">Load Key</button>
  <button onclick="clearKey()">Clear</button>
</div>

<h3>Available Skins</h3>
<div class="skins" id="skinsGrid"></div>

<div id="purchasedSection">
  <div id="purchasedTitle">Purchased Skins:</div>
  <div id="purchasedSkins"></div>
</div>

<div id="eventBarContainer"></div>

<div id="dealModal" role="dialog" aria-modal="true">
  <h3 id="dealModalTitle"></h3>
  <img id="dealModalImage" src="" alt="Deal image">
  <p id="dealModalDesc"></p>
  <div id="dealCountdown"></div>
  <div id="dealNav">
    <button onclick="prevDeal()">â¬… Previous</button>
    <button onclick="nextDeal()">Next âž¡</button>
  </div>
  <button id="buyDealBtn">Buy Deal</button>
  <button onclick="closeDealModal()">Close</button>
</div>

<script>
let currentKey = null;
let coins = 0, money = 0;
let owned = [];
let purchasedDeals = [];
let events = [];
let currentEventDeals = [];
let currentDealIndex = 0;
let dealCountdownInterval = null;

function showMessage(msg){ document.getElementById('infoText').textContent = msg; }

function getPublishedSkins(){ return JSON.parse(localStorage.getItem('skinsDataPublished')||'[]'); }
function getPublishedEvents(){ return JSON.parse(localStorage.getItem('eventDataPublished')||'[]'); }
function getPublishedDeals(){ return JSON.parse(localStorage.getItem('dealDataPublished')||'[]'); }

function loadKey(){
  const key = document.getElementById('keyInput').value.trim();
  if(!key){ showMessage('Enter a key'); return; }
  const data = JSON.parse(localStorage.getItem('skinshop_'+key) || '{}');
  currentKey = key;
  coins = data.coins||0;
  money = data.money||0;
  owned = data.owned||[];
  purchasedDeals = data.purchasedDeals||[];
  showMessage('âœ… Key loaded: '+key);
  renderSkins();
  renderEventBar();
}

function clearKey(){
  currentKey = null; coins = 0; money = 0; owned = []; purchasedDeals = [];
  document.getElementById('keyInput').value='';
  showMessage('Key cleared');
  renderSkins();
}

function saveUserData(){
  if(!currentKey) return;
  const data = {coins,money,owned,purchasedDeals};
  localStorage.setItem('skinshop_'+currentKey, JSON.stringify(data));
}

function renderSkins(){
  const allSkins = getPublishedSkins();
  const grid = document.getElementById('skinsGrid');
  const purchasedContainer = document.getElementById('purchasedSkins');
  grid.innerHTML=''; purchasedContainer.innerHTML='';

  allSkins.forEach(skin=>{
    const isOwned = owned.includes(skin.id);
    if(isOwned) addPurchasedItem(skin.image, skin.name);

    const container = document.createElement('div'); container.className='skinContainer';
    const card = document.createElement('div'); card.className='skin '+(isOwned?'owned grayed':'grayed');
    const img = document.createElement('img'); img.src=skin.image||''; img.alt=skin.name||'skin';
    card.appendChild(img);

    if(!isOwned){
      const lock = document.createElement('div'); lock.className='lock'; lock.textContent='ðŸ”’'; card.appendChild(lock);
      card.addEventListener('click', ()=>{
        if(!currentKey){ showMessage('Enter your key first'); return; }
        buySkin(skin.id, skin.price);
      });
    }

    container.appendChild(card);
    const nameDiv = document.createElement('div'); nameDiv.className='skinName'; nameDiv.textContent=skin.name;
    const priceDiv = document.createElement('div'); priceDiv.className='skinPrice'; priceDiv.textContent='Price: '+skin.price+' ðŸª™';
    container.appendChild(nameDiv); container.appendChild(priceDiv);
    grid.appendChild(container);
  });

  document.getElementById('coins').textContent = coins;
  document.getElementById('money').textContent = money.toFixed(2);
}

function addPurchasedItem(imgSrc,name){
  const container=document.getElementById('purchasedSkins');
  const img=document.createElement('img'); img.src=imgSrc||''; img.alt=name||''; container.appendChild(img);
}

function buySkin(id, price){
  if(coins<price){ showMessage('Not enough coins'); return; }
  coins -= price;
  owned.push(id);
  saveUserData();
  showMessage('âœ… Skin purchased');
  renderSkins();
}

/* ===== Event Bar ===== */
function renderEventBar(){
  events=getPublishedEvents()||[];
  const container=document.getElementById('eventBarContainer');
  container.innerHTML='';
  events.forEach((ev,idx)=>{
    const activeDeals=getPublishedDeals().filter(d=>d.eventId===ev.id && d.status==='active' && !purchasedDeals.includes(d.id));
    if(activeDeals.length===0) return;
    const card=document.createElement('div'); card.className='eventCard';
    const img=document.createElement('img'); img.src=ev.image||''; img.alt=ev.name||'';
    card.appendChild(img);
    const countdown=document.createElement('div'); countdown.className='eventCountdown'; countdown.textContent='';
    card.appendChild(countdown);
    card.addEventListener('click', ()=> openEventDeals(ev));
    container.appendChild(card);
  });
}

/* Deal modal functions (simplified for brevity) */
function openEventDeals(ev){ alert('Event deals click for '+ev.name); }
function closeDealModal(){ document.getElementById('dealModal').style.display='none'; }
function prevDeal(){}
function nextDeal(){}

/* Init */
(function init(){ renderSkins(); renderEventBar(); })();
</script>

</body>
</html>

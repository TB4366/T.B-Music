<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Legend Express Agar.io Extension</title>
    <style>
        /* Simpel menu bovenaan */
        #legendMenu {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 10px;
            border-radius: 8px;
            z-index: 9999;
            font-family: Arial, sans-serif;
        }
        #legendMenu button {
            display: block;
            margin: 5px 0;
            padding: 5px 10px;
            background: #1E90FF;
            border: none;
            border-radius: 4px;
            color: white;
            cursor: pointer;
        }
        #legendMenu button:hover {
            background: #104E8B;
        }
    </style>
    <script>
        const modVersion = '1.8';
        const version = 2;

        // Voeg het menu toe
        function addLegendMenu() {
            const menu = document.createElement('div');
            menu.id = 'legendMenu';

            const items = [
                {text: 'Legend Mod Website', url: 'http://jimboy3100.github.io'},
                {text: 'LM Library', url: 'https://github.com/jimboy3100/jimboy3100.github.io/'},
                {text: 'Donate for Legend Mod', url: 'https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=CM3GDVCW6PBF6'}
            ];

            items.forEach(item => {
                const btn = document.createElement('button');
                btn.textContent = item.text;
                btn.onclick = () => window.open(item.url, '_blank');
                menu.appendChild(btn);
            });

            document.body.appendChild(menu);
        }

        // Laad scripts of HTML
        function loadScript(url) {
            return fetch(url)
                .then(response => response.text())
                .then(scriptText => {
                    const scriptEl = document.createElement('script');
                    scriptEl.textContent = scriptText;
                    document.body.appendChild(scriptEl);
                });
        }

        function loadHTML(url) {
            fetch(url)
                .then(response => response.text())
                .then(htmlText => {
                    const injected = htmlText.replace("</body>", `<script>init('${modVersion}');</script></body>`);
                    document.open();
                    document.write(injected);
                    document.close();
                    setTimeout(() => history.pushState(null, null, "/"), 2000);
                });
        }

        // Redirect agar.io root naar legendmod
        if (location.host === "agar.io" && location.pathname === "/") {
            const url = window.location.href;
            localStorage.setItem("url", url);
            location.href = "https://agar.io/legendmod" + location.hash;
        }

        // Bepaal mode
        const mode = location.pathname.slice(1);
        let modWebsite;

        switch(mode) {
            case 'normal': modWebsite = 'https://agar.io'; loadHTML(modWebsite); break;
            case 'hslo': modWebsite = 'https://hslo.io/install.user.js'; loadScript(modWebsite); break;
            case 'agartool': modWebsite = 'https://www.agartool.io/agartool.user.js'; loadScript(modWebsite); break;
            case 'vanilla': modWebsite = 'http://imasters.org.ru/agar/js/vanilla.user.js'; loadScript(modWebsite); break;
            case 'ogario': modWebsite = 'https://cdn.ogario.ovh/v4/beta/ogario.v4.user.js'; loadScript(modWebsite); break;
            case 'delta': modWebsite = 'https://deltav4.glitch.me/v4/index.html'; loadHTML(modWebsite); break;
            case 'neo': 
                modWebsite = 'https://www.legendmod.ml/play.html?' + version; 
                loadHTML(modWebsite);
                setTimeout(() => loadScript('https://jimboy3100.github.io/ExampleScripts/Neoprivate.js'), 5000);
                break;
            case 'mobile': 
                modWebsite = 'https://www.legendmod.ml/play.html';
                loadHTML(modWebsite);
                setTimeout(() => loadScript('https://www.legendmod.ml/ExampleScripts/gamepad.user.js'), 5000);
                break;
            case 'captcha': modWebsite = 'https://www.legendmod.ml/ogario/captcha.html'; loadHTML(modWebsite); break;
            case 'legendmod':
            default: modWebsite = 'https://www.legendmod.ml/play.html?' + version; loadHTML(modWebsite); break;
        }

        window.onload = addLegendMenu;

        function getParameterByName(name, url) {
            if (!url) url = window.location.href;
            name = name.replace(/[\[\]]/g, "\\$&");
            const regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
                  results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, " "));
        }
    </script>
</head>
<body>
</body>
</html>

<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<title>Bot Controller</title>
<style>
body {
    background:#0e0e0e;
    color:#eee;
    font-family:Arial;
    padding:20px;
    max-width:520px;
}
label { margin-top:10px; display:block; }
input, select, button {
    width:100%;
    padding:8px;
    margin-top:5px;
}
.buttons {
    display:flex;
    gap:10px;
    margin-top:15px;
}
button.disabled {
    opacity:0.4;
    pointer-events:none;
}
#log {
    margin-top:20px;
    background:#1a1a1a;
    border:1px solid #333;
    padding:10px;
    height:230px;
    overflow-y:auto;
    font-size:13px;
}
</style>
</head>
<body>

<h2>Bot Setup</h2>

<label>Game Server (WebSocket)</label>
<input id="server" placeholder="ws://localhost:8080/game">

<label>UID (bots volgen)</label>
<input id="uid">

<label>Party Code</label>
<input id="partyCode">

<label>Game Mode</label>
<select id="gameMode">
    <option value="">-- selecteer --</option>
    <option value="classic">Classic</option>
    <option value="burst">Burst</option>
</select>

<div class="buttons">
    <button id="startBtn" class="disabled" onclick="startBots()">Start</button>
    <button onclick="stopBots()">Stop</button>
</div>

<div id="log"></div>

<script>
/* =========================
   CORE STATE
========================= */
let socket = null;
let botsRunning = false;
let bot_mode = false;

/* =========================
   VALIDATION
========================= */
function canStartBots() {
    return (
        document.getElementById("server").value.trim() !== "" &&
        document.getElementById("uid").value.trim() !== "" &&
        document.getElementById("partyCode").value.trim() !== "" &&
        document.getElementById("gameMode").value !== "" &&
        !botsRunning
    );
}

/* =========================
   UI UPDATE
========================= */
["server","uid","partyCode","gameMode"].forEach(id=>{
    document.getElementById(id).addEventListener("input",updateBtn);
    document.getElementById(id).addEventListener("change",updateBtn);
});
function updateBtn(){
    document.getElementById("startBtn")
        .classList.toggle("disabled",!canStartBots());
}

/* =========================
   CONNECT TO SERVER
========================= */
function connectServer() {
    const url = document.getElementById("server").value;
    socket = new WebSocket(url);

    socket.onopen = () => {
        log("Verbonden met game server");
        socket.send(JSON.stringify({ type:"connectBotController" }));
    };

    socket.onmessage = (event) => {
        const data = JSON.parse(event.data);
        if (data.message) log("SERVER: " + data.message);
    };

    socket.onerror = () => log("Server fout");
    socket.onclose = () => log("Verbinding gesloten");
}

/* =========================
   START BOTS
========================= */
function startBots() {
    if (!canStartBots()) {
        log("Start mislukt: invoer ontbreekt");
        return;
    }

    connectServer();

    botsRunning = true;
    bot_mode = true;

    const payload = {
        type: "startBots",
        uid: document.getElementById("uid").value,
        party: document.getElementById("partyCode").value,
        mode: document.getElementById("gameMode").value
    };

    setTimeout(() => {
        socket.send(JSON.stringify(payload));
        log("Start Bots verzonden naar server");
        botLoop();
    }, 500);
}

/* =========================
   STOP BOTS
========================= */
function stopBots() {
    if (!botsRunning) return;

    botsRunning = false;
    bot_mode = false;

    if (socket) {
        socket.send(JSON.stringify({ type:"stopBots" }));
        socket.close();
    }

    log("Bots stopped");
}

/* =========================
   BOT LOOP (server gestuurd)
========================= */
function botLoop() {
    if (!botsRunning || !socket) return;

    socket.send(JSON.stringify({
        type: "botAction",
        uid: document.getElementById("uid").value,
        mode: document.getElementById("gameMode").value
    }));

    setTimeout(botLoop, 1000);
}

/* =========================
   LOG
========================= */
function log(msg) {
    const l = document.getElementById("log");
    l.innerHTML += `[${new Date().toLocaleTimeString()}] ${msg}<br>`;
    l.scrollTop = l.scrollHeight;
}
</script>

</body>
</html>

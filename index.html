<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<title>Advanced Music Player</title>
<style>
 body { font-family: Arial; padding: 20px; }
 button { padding: 10px; margin: 5px; }
 .block { border: 1px solid #ccc; padding: 10px; margin: 10px 0; }
 .list-item { padding: 5px; margin: 4px 0; background: #f2f2f2; }
</style>
</head>
<body>
<h2>Muziekspeler met Playlist + Reclames + Opslag</h2>

<div class="block">
 <h3>Muziek uploaden</h3>
 <input type="file" id="audioUpload" accept="audio/*" multiple>
 <button onclick="uploadAudio()">Upload audio</button>
</div>

<div class="block">
 <h3>Reclames uploaden</h3>
 <input type="file" id="adUpload" accept="audio/*" multiple>
 <button onclick="uploadAds()">Upload reclame(s)</button>
 <p>Reclames in systeem: <span id="adCount">0</span></p>
</div>

<div class="block">
 <h3>Instellingen reclame</h3>
 <label>Aantal normale nummers voordat een reclame begint: </label>
 <input type="number" id="adInterval" value="2" min="1" max="10">
 <br><br>
 <label>Aantal reclames achter elkaar: </label>
 <input type="number" id="adChain" value="1" min="1" max="5">
</div>

<div class="block">
 <h3>Playlist</h3>
 <div id="playlist"></div>
</div>

<div class="block">
 <h3>Reclamelijst</h3>
 <div id="adList"></div>
</div>

<div class="block">
 <h3>Bediening</h3>
 <button onclick="playMusic()">‚ñ∂ afspelen</button>
 <button onclick="stopMusic()">‚èπ stop</button>
 <button onclick="nextTrack()">‚è≠ volgende</button>
 <button onclick="prevTrack()">‚èÆ vorige</button>
 <button onclick="saveAll()">üíæ Opslaan</button>
</div>

<audio id="player" controls style="width:100%; margin-top:20px;"></audio>

<script>
let playlist = JSON.parse(localStorage.getItem('playlist') || '[]');
let ads = JSON.parse(localStorage.getItem('ads') || '[]');
let currentIndex = 0;
let adCounter = 0;
let playingAds = false;
let adQueue = [];
const player = document.getElementById("player");

function refreshUI() {
 document.getElementById("playlist").innerHTML = playlist.map((p,i)=>`
  <div class='list-item'>${i+1}. ${p.name}
   <button onclick='removeTrack(${i})'>X</button>
  </div>`).join('');
 document.getElementById("adList").innerHTML = ads.map((p,i)=>`
  <div class='list-item'>${i+1}. ${p.name}
   <button onclick='removeAd(${i})'>X</button>
  </div>`).join('');
 document.getElementById("adCount").innerText = ads.length;
}

function uploadAudio() {
 const files = document.getElementById("audioUpload").files;
 for (let f of files) {
  let url = URL.createObjectURL(f);
  playlist.push({name: f.name, url});
 }
 refreshUI();
}

function uploadAds() {
 const files = document.getElementById("adUpload").files;
 for (let f of files) {
  let url = URL.createObjectURL(f);
  ads.push({name: f.name, url});
 }
 refreshUI();
}

function playMusic() {
 if (!playlist.length) return alert("Geen nummers in playlist!");
 playTrack();
}

function playTrack() {
 if (playingAds) return;
 if (adCounter >= Number(document.getElementById("adInterval").value)) {
  queueAds();
  return;
 }
 player.src = playlist[currentIndex].url;
 player.play();
}

player.onended = () => {
 if (playingAds) {
  if (adQueue.length > 0) {
   let nextAd = adQueue.shift();
   player.src = nextAd;
   player.play();
  } else {
   playingAds = false;
   adCounter = 0;
   nextTrack();
  }
 } else {
  adCounter++;
  nextTrack();
 }
};

function queueAds() {
 playingAds = true;
 adQueue = [];
 let count = Number(document.getElementById("adChain").value);
 for (let i = 0; i < count; i++) {
  let randomAd = ads[Math.floor(Math.random() * ads.length)];
  if (randomAd) adQueue.push(randomAd.url);
 }
 let firstAd = adQueue.shift();
 player.src = firstAd;
 player.play();
}

function nextTrack() {
 currentIndex = (currentIndex + 1) % playlist.length;
 playTrack();
}

function prevTrack() {
 currentIndex = (currentIndex - 1 + playlist.length) % playlist.length;
 playTrack();
}

function stopMusic() {
 player.pause();
}

function removeTrack(i) {
 playlist.splice(i,1);
 refreshUI();
}

function removeAd(i) {
 ads.splice(i,1);
 refreshUI();
}

function saveAll() {
 localStorage.setItem('playlist', JSON.stringify(playlist));
 localStorage.setItem('ads', JSON.stringify(ads));
 alert("Alles opgeslagen!");
}

refreshUI();
</script>
</body>
</html>

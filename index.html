// server.js (node >= 14)
const express = require('express');
const fetch = require('node-fetch'); // npm i node-fetch@2
const bodyParser = require('body-parser');

const app = express();
app.use(bodyParser.json({limit:'10mb'}));

const PORT = process.env.PORT || 3000;

// --- CONFIGUREER HIER ---
// De echte Agar.io upload URL / endpoint (onbekend / privÃ©): vul deze in wanneer je die hebt.
const AGARIO_UPLOAD_URL = process.env.AGARIO_UPLOAD_URL || 'https://example.com/agar-upload-placeholder';

app.post('/upload-skin', async (req, res) => {
  try {
    const body = req.body;
    console.log('Ontvangen payload:', { uid: body.uid, skinName: body.skinName });

    // Hier kun je validaties doen, opslaan in DB, of doorsturen naar Agar.io
    // Voorbeeld: doorsturen als multipart/form-data of JSON afhankelijk van wat de API vereist.

    // ----- VOORBEELD: doorsturen als JSON naar AGARIO_UPLOAD_URL -----
    const forwardResp = await fetch(AGARIO_UPLOAD_URL, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        // mogelijk moet je hier cookies of autorisatieheaders toevoegen
        // 'Authorization': 'Bearer <TOKEN>'
      },
      body: JSON.stringify(body)
    });

    const text = await forwardResp.text();
    res.status(200).send({ forwardedStatus: forwardResp.status, responseText: text });
  } catch (err) {
    console.error(err);
    res.status(500).send({ error: String(err) });
  }
});

app.listen(PORT, ()=> console.log('Server running on port', PORT));

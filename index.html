<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<title>Bedrijfs Radio Station</title>
<style>
 body { font-family: Arial; padding: 20px; background:#111; color:#fff; }
 h2{color:#4ff;} button{padding:10px;margin:5px;border:0;background:#4ff;color:#000;font-weight:bold;cursor:pointer;border-radius:8px;} 
 .block{background:#222;padding:15px;border-radius:10px;margin:15px 0;}
 .list-item{background:#333;padding:8px;border-radius:6px;margin:6px 0;}
</style>
</head>
<body>
<header style="text-align:center;padding:20px;background:#0a0a0a;border-radius:10px;margin-bottom:15px;">
 <img src="logo.png" alt="Bedrijfslogo" style="height:80px;">
 <h1>üìª Bedrijfs Radio Station PRO</h1>
 <p>Professionele radio voor bedrijven ‚Äì volledig automatisch, met reclames, jingles en programmering.</p>
</header>

<div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;">
 <div class="block">
   <h3>Muziek Uploaden</h3>
   <input type="file" id="musicUpload" accept="audio/*" multiple>
   <button onclick="uploadMusic()">Upload</button>
   <div id="musicList"></div>
 </div>

 <div class="block">
   <h3>Reclames Uploaden</h3>
   <input type="file" id="adUpload" accept="audio/*" multiple>
   <button onclick="uploadAd()">Upload Reclame</button>
   <p>Totaal reclames: <span id="adCount">0</span></p>
   <div id="adList"></div>
 </div>

 <div class="block">
   <h3>Jingles (Voice-overs)</h3>
   <input type="file" id="jingleUpload" accept="audio/*" multiple>
   <button onclick="uploadJingle()">Upload Jingle</button>
   <div id="jingleList"></div>
 </div>

 <div class="block">
   <h3>Programmering</h3>
   <label>Reclameblok elke:</label>
   <select id="schedule">
     <option value="5">5 minuten</option>
     <option value="10">10 minuten</option>
     <option value="30">30 minuten</option>
     <option value="60">60 minuten</option>
   </select>
   <br><br>
   <label>Start automatisch bij openen:</label>
   <input type="checkbox" id="autoStart">
 </div>

 <div class="block">
   <h3>Radio Bediening</h3>
   <button onclick="startRadio()">‚ñ∂ Start Radio</button>
   <button onclick="stopRadio()">‚èπ Stop</button>
   <button onclick="nextSong()">‚è≠ Volgende</button>
   <button onclick="playRandom()">üîÄ Shuffle</button>
 </div>
</div>

<audio id="player" controls style="width:100%;margin-top:20px;"></audio id="player" controls style="width:100%;margin-top:20px;"></audio>

<script>
// --- FIX: bestanden worden nu opgeslagen in IndexedDB zodat ze blijven werken na refresh ---
// IndexedDB helper
function saveFileToDB(store, fileObj) {
 return new Promise((resolve)=>{
   const req = indexedDB.open('RadioDB',1);
   req.onupgradeneeded = ()=>{
     const db=req.result;
     if(!db.objectStoreNames.contains('music')) db.createObjectStore('music');
     if(!db.objectStoreNames.contains('ads')) db.createObjectStore('ads');
   };
   req.onsuccess = ()=>{
     const db=req.result;
     const tx=db.transaction(store,'readwrite');
     tx.objectStore(store).put(fileObj.file, fileObj.name);
     tx.oncomplete=()=>resolve();
   };
 });
}

function loadFilesFromDB(store){
 return new Promise((resolve)=>{
   const req=indexedDB.open('RadioDB',1);
   req.onsuccess=()=>{
     const db=req.result;
     const tx=db.transaction(store,'readonly');
     const storeObj=tx.objectStore(store);
     const result=[];
     storeObj.openCursor().onsuccess=(ev)=>{
       const cursor=ev.target.result;
       if(cursor){
         result.push({ name: cursor.key, blob: cursor.value });
         cursor.continue();
       } else resolve(result);
     };
   };
 });
}

let music=[];
let ads=[];
let interval=3;
let chain=1;
let index=0;
let playCount=0;
let playingAds=false;
let adQueue=[];
const player=document.getElementById('player');

async function init(){
 const savedMusic=await loadFilesFromDB('music');
 const savedAds=await loadFilesFromDB('ads');
 music=savedMusic.map(f=>({ name:f.name, url:URL.createObjectURL(f.blob) }));
 ads=savedAds.map(f=>({ name:f.name, url:URL.createObjectURL(f.blob) }));
 refresh();
}

function refresh(){
 musicList.innerHTML=music.map((m,i)=>`<div class='list-item'>${i+1}. ${m.name}</div>`).join('');
 adList.innerHTML=ads.map((a,i)=>`<div class='list-item'>${i+1}. ${a.name}</div>`).join('');
 adCount.innerText=ads.length;
 interval.value=interval;
 chain.value=chain;
}

async function uploadMusic(){
 const files=musicUpload.files;
 for(let f of files){
   music.push({name:f.name, url:URL.createObjectURL(f)});
   await saveFileToDB('music',{name:f.name,file:f});
 }
 refresh();
}

async function uploadAd(){
 const files=adUpload.files;
 for(let f of files){
   ads.push({name:f.name, url:URL.createObjectURL(f)});
   await saveFileToDB('ads',{name:f.name,file:f});
 }
 refresh();
}

function saveConfig(){
 interval=Number(document.getElementById('interval').value);
 chain=Number(document.getElementById('chain').value);
 localStorage.setItem('radio_interval',interval);
 localStorage.setItem('radio_chain',chain);
 alert("Instellingen opgeslagen!");
}

function startRadio(){ if(!music.length){alert('Geen muziek!');return;} playSong(); }

function playSong(){
 if(playingAds)return;
 if(playCount>=interval){ playAds(); return; }
 player.src=music[index].url;
 player.play();
}

function playAds(){
 playingAds=true;
 adQueue=[];
 for(let i=0;i<chain;i++){
   let r=ads[Math.floor(Math.random()*ads.length)];
   if(r) adQueue.push(r.url);
 }
 let first=adQueue.shift();
 if(first){ player.src=first; player.play(); }
}

player.onended=()=>{
 if(playingAds){
   if(adQueue.length>0){ player.src=adQueue.shift(); player.play(); }
   else{ playingAds=false; playCount=0; nextSong(); }
 } else {
   playCount++; nextSong();
 }
};

function nextSong(){ index=(index+1)%music.length; playSong(); }
function stopRadio(){ player.pause(); }

init();
</script>
</body>
</html>
